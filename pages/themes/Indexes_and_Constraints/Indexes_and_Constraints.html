<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Indexes_and_Constraints</title>
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
	<link rel="icon" type="image/x-icon" href="../../../outfit/images/favicons/mysql_logo.png">
	<!-- css & themes include -->
	<link rel="stylesheet" href="../../../lib/reveal.js/css/reveal.css">
	<link rel="stylesheet" href="../../../outfit/css/themes/light.css" id="theme">
	<!-- Printing and PDF exports -->
	<script>
		var link = document.createElement( 'link' );
		link.rel = 'stylesheet';
		link.type = 'text/css';
		link.href = window.location.search.match( /print-pdf/gi ) ? '../../../lib/reveal.js/css/print/pdf.css' : '../../../lib/reveal.js/css/print/paper.css';
		document.getElementsByTagName( 'head' )[0].appendChild( link );
	</script>
	<!--[if lt IE 9]>
	<script src="lib/js/html5shiv.js"></script>
	<![endif]-->
	<!-- custom -->
	<link rel="stylesheet" href="../../../outfit/css/reveal.js.css">
	<base target="_blank">
</head>
<body>
	<div class="reveal default center" data-transition-speed="default" data-background-transition="default">
		<div class="top_links">
			<a class="home_link" href="../../../index.html#Indexes_and_Constraints" target="_top"><i class="fa fa-home"></i></a>
			<span class="help_link"><i class="fa fa-question"></i></span>
			<div class="help_text">
				<div class="note">Keyboard shortcuts:</div>
				<div><span>N/Спейс</span><span>Next Slide</span></div>
				<div><span>P</span><span>Previous Slide</span></div>
				<div><span>O</span><span>Slides Overview</span></div>
				<div><span>ctrl+left click</span><span>Zoom Element</span></div>
				<div class="print-howto"><br>If you want print version => add '<code>?print-pdf</code>' <br> at the end of slides URL (remove '#' fragment) and then print. <br>
				Like: https://wwwcourses.github.io/...CourseIntro.html?print-pdf </div>
			</div>
		</div>
		<div class="footer theme_switch">
			<a href="#" onclick="document.getElementById('theme').setAttribute('href','../../../outfit/css/themes/dark.css'); return false;">Dark</a>
			<a href="#" onclick="document.getElementById('theme').setAttribute('href','../../../outfit/css/themes/light.css'); return false;">Light</a>
			<!-- <a href="#" onclick="document.getElementById('theme').setAttribute('href','../../../outfit/css/themes/projector.css'); return false;">Projector</a> -->
		</div>
		<div class="slides">
<!--
########################################################
##################### SLIDES START #####################
########################################################
-->
<section><h1>MySQL Indexes and Constraints</h1></section>
<section data-transition="zoom">
	<section>
		<div class="copyright">
			<div class="note">
				<p>Created for</p>
			</div>
			<div class="company">
				<a href="https://progressbg.net/javascript-advanced-with-reactjs/">
				<img src="../../../outfit/images/logos/ProgressBG_logo_529_127.png" alt="ProgressBG_logo">
				</a>
			</div>
		</div>
	</section>
	<section class="copyright" data-transition="zoom" style="margin-top: -2em;">
		<div class="note">
			<p>Created by</p>
		</div>
		<div class="company">
		   <div class="LI-profile-badge"  data-version="v1" data-size="large" data-locale="en_US" data-type="vertical" data-theme="dark" data-vanity="ivapopova"><a class="LI-simple-link" href="https://bg.linkedin.com/in/ivapopova?trk=profile-badge">Iva E. Popova</a></div>
		</div>
		<!-- <div class="author">
			<a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png"></a>
		</div> -->
	</section>
</section>


<section data-min="5"><h1>MySQL_Indexes</h1></section>
<section id="intro"><h2>Introduction</h2>
	<section><h3>What and Why?</h3>
		<dl class="fa">
		   <dt>A database index is added to a table <span class="note">to speed up the search</span> operation.</dt>
		   <dt>An index is used by the Database Search Engine to locate records very fast.</dt>
		   <dt>Indexes can be created for one or more columns.</dt>
		   <dt>Indexes are implemented as a type of tables, which keep index field and a pointer to each record into the actual table.</dt>
		   <dt>While adding index to a table will speed the SELECT queries, it will <span class="note">slow down</span> the INSERT and UPDATE statement.</dt>
		</dl>
	</section>
	<section><h3>Types of indexes</h3>
		<dl class="fa">
			<dt>A regular INDEX</dt>
			<dt>PRIMARY KEY</dt>
			<dt>FULLTEXT</dt>
		</dl>
	</section>
</section>
<section id="regular_indexes"><h2>Regular index</h2>
	<section id="add_index"><h3>Add regular Index to a table</h3>
		<p>The syntax:</p>
		<pre><code>
			ALTER TABLE table_name ADD INDEX(column_name(index_length));
		</code></pre>
		<dl class="fa">
			<dt>The <span class="code">index_length</span> could be specified to minimize the size of the index, and to optimize database access speed.</dt>

			<dt class="note">Consider adding Regular Index to  columns which will be searched most often</dt>
		</dl>
	</section>
	<section id="add_index_example"><h3>Example</h3>
		<p>Let's have the <span class="code">artist</span> table, defined as:</p>
		<pre><code rel="SQl">
			mysql music_db_admin@localhost:music_db> desc artist;
			+---------+-------------+--------+-------+-----------+---------+
			| Field   | Type        | Null   | Key   |   Default | Extra   |
			|---------+-------------+--------+-------+-----------+---------|
			| fname   | varchar(20) | YES    |       |    &lt;null&gt; |         |
			| lname   | varchar(20) | NO     |       |    &lt;null&gt; |         |
			+---------+-------------+--------+-------+-----------+---------+
		</code></pre>
		<p>An index could be added as:</p>
		<pre><code>
			ALTER TABLE artist ADD INDEX(lname(10));
		</code></pre>
		<p>Resulting in:</p>
		<pre><code rel="SQl">
			mysql music_db_admin@localhost:music_db> desc artist;
			+---------+-------------+--------+-------+-----------+---------+
			| Field   | Type        | Null   | Key   |   Default | Extra   |
			|---------+-------------+--------+-------+-----------+---------|
			| fname   | varchar(20) | YES    |       |    &lt;null&gt; |         |
			| lname   | varchar(20) | NO     | MUL   |    &lt;null&gt; |         |
			+---------+-------------+--------+-------+-----------+---------+
		</code></pre>
		<p>The <span class="note">MUL</span> key means that multiple occurrences of a value may occur within that column.</p>
	</section>
	<section id="create_index"><h3>Using CREATE INDEX</h3>
		<p>The syntax:</p>
		<pre><code>
			CREATE INDEX column_name ON table_name (column_name(index_length));
		</code></pre>
		<dl class="fa">
			<dt>It is an alternative to adding an index with ALTER TABLE.</dt>
			<dt><span class="note">NB!</span> They are equivalent, except that CREATE INDEX cannot be used to create a PRIMARY KEY</dt>
		</dl>
	</section>
	<section id="on_create_table"><h3>Adding indexes when creating tables</h3>
		<dl class="fa">
			<dt>You should be aware that adding an index to a large table can take a very long time.</dt>
			<dt class="note">That's why is better to add Regular Index when creating the table!</dt>
		</dl>

		<pre><code>
			CREATE TABLE artist (
				fname VARCHAR(20) DEFAULT NULL,
				lname VARCHAR(20) NOT NULL,
				INDEX(lname(10))
			);
		</code></pre>
	</section>
</section>
<section id="primary_key"><h2>Primary key</h2>
	<section><h3>Why using Primary Key?</h3>
		<dl class="fa">
			<dt>Regular indexes do not impose the values to be unique!</dt>
			<dt>The importance of having a key with a unique value for each row will come up when we start to combine data from different tables.</dt>
		</dl>

	</section>
	<section id="primary_key_create"><h3>Create</h3>
		<p>By adding the PRIMARY KEY(column_name) at the end of CREATE TABLE.</p>
		<pre><code>
			CREATE TABLE artist (
				id MEDIUMINT(4) NOT NULL AUTO_INCREMENT,
				fname VARCHAR(20) DEFAULT NULL,
				lname VARCHAR(20) NOT NULL,
				PRIMARY KEY(id)
			);
		</code></pre>
		<p>Resulting in:</p>
		<pre><code>
			+---------+--------------+--------+-------+-----------+----------------+
			| Field   | Type         | Null   | Key   |   Default | Extra          |
			|---------+--------------+--------+-------+-----------+----------------|
			| id      | mediumint(4) | NO     | PRI   |    &lt;null&gt; | auto_increment |
			| fname   | varchar(20)  | YES    |       |    &lt;null&gt; |                |
			| lname   | varchar(20)  | NO     |       |    &lt;null&gt; |                |
			+---------+--------------+--------+-------+-----------+----------------+
		</code></pre>
		<p><span class="note">NB!</span> As PRIMARY KEY requires unique values, the <span class="code">NOT NULL</span> and/or <span class="code">AUTO_INCREMENT</span> attribute should be present.</p>
	</section>
</section>
<section id="auto_increment"><h2>The AUTO_INCREMENT attribute</h2>
	<section id="auto_increment"><h3>The AUTO_INCREMENT attribute</h3>
		<dl class="fa">
			<dt>The AUTO_INCREMENT attribute can be used to generate a unique identity for new rows.</dt>
			<dt>A column defined with that attribute will set the value of its contents to that of the column entry in the previously inserted row, plus 1.</dt>
		</dl>

	</section>
</section>

<section data-min="5"><h1>SQL Constraints and Foreign Key</h1></section>
<section id="constraints"><h2>SQL Constraints</h2>
	<section><h3>Overview</h3>
		<dl class="fa">
			<dt>MySQL constraints are used to define rules to allow or restrict what values can be stored in columns. The purpose of inducing constraints is to enforce the integrity of a database</dt>
			<dt>Constraints are used to limit the type of data that can be inserted into a table</dt>
			<dt>MySQL supports next constraints:, "<code>NOT NULL</code>", "<code>UNIQUE</code>", "<code>PRIMARY KEY</code>", "<code>FOREIGN KEY</code>", "<code>CHECK</code>", "<code>DEFAULT</code>"
			</dt>
			<pre><code class="syntax">
				CREATE TABLE table_name(
					column_name data_type(size) constraint_name,
					...
				);
			</code></pre>
			<dt>Reference: <a href="https://www.w3resource.com/mysql/creating-table-advance/constraint.php">MySQL Constraint @w3resource</a></dt>
		</dl>
	</section>
	<!-- <section><h3>The syntax in CREATE TABLE</h3>
		<p>Constraint on single column:</p>
		<pre><code class="sql">
			CREATE TABLE table_name(
				column_name data_type(size) constraint_name,
				...
			);
		</code></pre>
		<p>you can define constraints on more than one column, by using constraint on table, like:</p>
		<pre><code>
			CREATE TABLE author(
				id int(4) key auto_increment,
				fname varchar(200),
				lname varchar(200),
				UNIQUE(fname,lname)
			)
		</code></pre>
	</section> -->
	<section><h3>NOT NULL</h3>
		<p>Indicates that a column cannot store NULL value</p>
		<pre><code>
			CREATE TABLE book (
				id SMALLINT(3) UNSIGNED NOT NULL,
				...
			);
		</code></pre>
	</section>
	<section><h3>DEFAULT</h3>
		<p>Specifies a default value for a column</p>
		<pre><code>
			CREATE TABLE book (
				pub_year MEDIUMINT(4) DEFAULT NULL,
				...
			);
	</code></pre>
	</section>
	<section><h3>UNIQUE</h3>
		<p>Ensures that each row for a column must have a <span class="note">unique</span> value</p>
		<pre><code>
			CREATE TABLE book (
				book_name VARCHAR(250) NOT NULL UNIQUE,
				...
			);
		</code></pre>
		<p>Some vendors, MySQL as well, allows a UNIQUE column to be set with <span class="keyword">DEFAULT NULL</span> values, as by definition a NULL value is not equal to a NULL value. Anyway, it is not recommended to have UNIQUE and DEFAULT NULL column.</p>
	</section>
	<section><h3>CHECK</h3>
	   <p class="advanced">Self-learning section:</p>
	   <a href="http://www.w3schools.com/sql/sql_check.asp">w3schools: SQL CHECK Constraint</a>
	</section>
	<section><h3>PRIMARY KEY</h3>
		<dl class="fa">
			<dt>Primary Key is a combination of a NOT NULL and UNIQUE.</dt>
			<dt>Primary Key ensures that a column (or combination of two or more columns) have a unique identity which helps to find a particular record in a table more easily and quickly</dt>
			<dt>We can add Primary Key within the column definition, like:</dt>
			<pre><code rel="Example" class="mysql">
				CREATE TABLE book (
					id SMALLINT(3) UNSIGNED NOT NULL PRIMARY KEY,
					...
				);
			</code></pre>
			<dt>We can also add Primary Key within table definition, which allows us to set multiple columns as Primary Key:</dt>
			<pre><code rel="Example" class="mysql">
				CREATE TABLE book (
					id SMALLINT(3) UNSIGNED NOT NULL,
					isbn SMALLINT(3) UNSIGNED NOT NULL,
					author VARCHAR(10) NOT NULL,
					PRIMARY KEY (id,isbn)
				);
			</code></pre>
		</dl>
	</section>
</section>
<section id="foreign_key"><h2>FOREIGN KEY constraints</h2>
	<section><h3>What is a FOREIGN KEY?</h3>
		<dl class="fa fs-small">
			<dt>A FOREIGN KEY in one table points to a PRIMARY KEY in another table.</dt>
			<dt>FOREIGN KEY relationships involve a <span class="note">parent table</span> that holds the central data values, and a <span class="note">child table</span> with identical values pointing back to its parent.</dt>
			<dt>The FOREIGN KEY clause is specified in the child table. The parent and child tables must use the same storage engine. They must not be TEMPORARY tables.</dt>
			<dt>Reference: <a href="https://dev.mysql.com/doc/refman/8.0/en/create-table-foreign-keys.html">FOREIGN KEY Constraints</a></dt>
		</dl>
		<pre><code>
			# define the Parent Table
			CREATE TABLE `customers` (
				`id` int NOT NULL AUTO_INCREMENT,
				`first_name` varchar(45) NOT NULL,
				`last_name` varchar(45) NOT NULL,
				`email` varchar(100) DEFAULT NULL,
				PRIMARY KEY (`id`)
			) DEFAULT CHARSET=utf8;

		</code></pre>
		<pre><code>
			# define the Child Table
			CREATE TABLE `orders` (
				`id` int NOT NULL AUTO_INCREMENT,
				`customer_id` int NOT NULL,
				`order_date` datetime NOT NULL,
				PRIMARY KEY (`id`),
				FOREIGN KEY (`customer_id`) REFERENCES `customers` (`id`)
			) DEFAULT CHARSET=utf8;

		</code></pre>
	</section>
	<section><h3>Example on child table insert</h3>
		<dl class="fa">
			<dt>Note, that if we try to insert into orders the id of a customer, who does not exists, MySQL will through an error</dt>
		</dl>
		<pre><code rel="Terminal" class="bash">
			INSERT INTO orders (customer_id,order_date)
				VALUES (1, "2020-01-20 21:00:00");

			# Cannot add or update a child row: a foreign key constraint fails
		</code></pre>
	</section>
	<section><h3>customersdb ER Diagram</h3>
		<p><a href="./images/customers_db_ERDiagram.png"><img src="./images/customers_db_ERDiagram.png" alt="customers_db_ERDiagram.png" style="height: 60vh;"></a></p>
		<dl class="fa">
			<dt>This implements <span class="note">"one to many"</span> relation!</dt>
			<dd><span class="note">One</span> customer can have <span class="note">many</span> orders.</dd>
			<dt>If we need <span class="note">"many to many"</span> relation we could make third table: <code>customers_orders</code> which will store foreign keys to <code>customers(id)</code> and <code>orders(id)</code> </dt>
		</dl>
	</section>
	<section><h3>FOREIGN KEY Constraint</h3>
		<p>Ensure the <span class="keyword">referential integrity</span> of the data in one table to match values in another table</p>
		<p>MySQL supports FOREIGN KEY Constraint only for <a href="http://dev.mysql.com/doc/refman/8.0/en/using-innodb-tables.html">InnoDB tables</a></p>
	</section>
	<section><h3>FOREIGN KEY Constraint</h3>
		<p>The syntax</p>
		<pre><code class="fs-big bash">
			[CONSTRAINT constraint_name]
			FOREIGN KEY [fk_name] (index_columns)
			REFERENCES tbl_name (index_columns)
			[ON DELETE action]
			[ON UPDATE action]
			[MATCH FULL | MATCH PARTIAL | MATCH SIMPLE]
		</code></pre>
		<dl class="fa fs-small">
			<dt>The CONSTRAINT clause, if given, supplies a name for the foreign key constraint. If you omit it, InnoDB creates a name.</dt>
			<dt>FOREIGN KEY indicates the indexed columns in the child table that must match index values in the parent table. fk_name is the foreign key ID. If given, it is ignored unless InnoDB automatically creates an index for the foreign key; in that case, fk_name becomes the index name.</dt>
			<dt>REFERENCES names the parent table and the index columns in that table to which the foreign key in the child table refers. The index_columns part of the REFERENCES clause must have the same number of columns as the index_columns that follows the FOREIGN KEY keywords.</dt>

		</dl>
	</section>
	<section><h3>FOREIGN KEY Constraint: ON DELETE</h3>
		<dl class="fa fs-small">
			<dt>ON DELETE specifies what happens to the child table when parent table rows are deleted.</dt>
			<dt class="note">ON DELETE CASCADE causes matching child rows to be deleted when the corresponding parent row is deleted. In essence, the effect of the delete is cascaded from the parent to the child. This enables you to perform multiple-table deletes by deleting rows only from the parent table and letting InnoDB delete the corresponding rowsfrom the child table.</dt>
			<dt>For MySQL InnoDB tables ON DELETE NO ACTION and ON DELETE RESTRICT are the same as omitting the ON DELETE clause,as the foreign key constraints are checked immediately.</dt>
			<dt>ON DELETE SET NULL causes index columns in matching child rows to be set to NULL when the parent row is deleted. If you use this option, all the indexed child table columns named in the foreign key definition must be defined topermit NULL values</dt>
		</dl>
	</section>
	<section><h3>FOREIGN KEY Constraint: ON UPDATE</h3>
		<dl class="fa fs-small">
			<dt>ON UPDATE enables you to specify what happens to the child table when parent table rows are updated.</dt>
			<dt>If ON UPDATE clause is not present, the default behaviour is to reject any inserts or updates in the child table that result in foreign key values that don’t have any match in the parent table index, and to prevent updates to parent table index values to which child rows point. </dt>
			<dt>The possible action values are the same as for ON DELETE and have similar effects.</dt>
		</dl>
	</section>
	<section><h3>FOREIGN KEY Constraint: Guidelines</h3>
		<dl class="fa fs-small">
			<dt>You must create the parent table index explicitly before defining the foreign key relationship.</dt>
			<dt>InnoDB automatically creates an index on foreign key columns (the referencing columns) in the child table if the CREATE TABLE statement does not include such an index.</dt>
			<dd>The automatically created index will be a <span class="note">non unique</span> index and will include only the foreign key columns.</dd>
			<dd>You should define the index in the child table explicitly if you want it to be a PRIMARY KEY or UNIQUE index, or if it should include other columns in addition to those in the foreign key.</dd>
			<dt>Corresponding columns in the parent and child indexes must have compatible types.</dt>
				<dd>Corresponding <span class="note">character columns</span> must be <span class="note">the same length</span>.</dd>
				<dd>Corresponding <span class="note">integer columns</span> must have <span class="note">the same size</span> and <span class="note">same range</span> (signed or unsigned).</dd>
			<dt>For string columns, you must index the entire column, not just a leading prefix of it.</dt>
		</dl>
	</section>
	<section><h3>FOREIGN KEY Constraint: Examples</h3>
		<dl class="fa fs-small">
			<dt>Download <a href="slides_examples/books_db_schema.sql">books_db schema</a></dt>
			<dt>Download <a href="slides_examples/books_db_sample_data.sql">books_db sample data</a></dt>
			<dt>Now let's delete an author from the <span class="code">author</span> table:</dt>
			<pre><code class="SQL">
				DELETE FROM author WHERE lname='Vonnegut' and fname='Kurt';
			</code></pre>
			<dt>And check what happens with the books in <span class="code">book</span> table:</dt>
			<pre><code>
				SELECT author.fname, author.lname, book_name FROM book, author WHERE book.author_id=author.id;
			</code></pre>
		</dl>
	</section>
	<section><h3>FOREIGN KEY Constraint: Exercises</h3>
		<dl class="fa fs-small">
			<dt>Create the next <a href="slides_examples/books_db_schema.sql">books_db schema</a> and insert the <a href="slides_examples/books_db_sample_data.sql">books_db sample data</a></dt>
			<dt>Set <span class="note">ON UPDATE</span> constraint on <span class="code">fk_AuthorID</span> which will force the MySQL to automatically update all rows in <span class="code">book</span> table, when a corresponding row in <span class="code">author</span> table has changed.</dt>
			<dt>Set the <span class="code">author.id</span> to be 100 for Charles Dodgson author row.</dt>
			<dt>Check what happens with <span class="code">author_id</span> in the respective rows in <span class="code">book</span> table.</dt>
		</dl>
	</section>
</section>


<section class="disclaimer" data-background="../../../outfit/images/for_slides/the_end_on_sand.jpg">
	 <p>These slides are based on</p>
	 <p>customised version of </p>
	 <p><a href="http://hakim.se/">Hakimel</a>'s <a href="http://lab.hakim.se/reveal-js">reveal.js</a></p>
	 <p>framework</p>
</section>
<!--
########################################################
##################### SLIDES END   #####################
########################################################
-->
		</div>
	</div>
	<!-- Custom processing -->
	<script src="../../../outfit/js/slides.js"></script>
	<!-- external scripts -->
	<script src="../../../lib/reveal.js/lib/js/head.min.js"></script>
	<script src="../../../lib/reveal.js/js/reveal.js"></script>
	<!-- init reveal -->
	<script>
		// Full list of configuration options available at:
		// https://github.com/hakimel/reveal.js#configuration
		var highlightjsTabSize = '  ';
		Reveal.initialize({
			controls: true,
			progress: true,
			slideNumber: 'c/t',
			keyboard: true,
			history: true,
			center: true,
			width: '100%',
			height: '100%',
			// slide transition
			transition: 'concave', // none/fade/slide/convex/concave/zoom
			// Factor of the display size that should remain empty around the content
			margin: 0.1,
			// shift+maous click to zoom in/out element
			zoomKey: 'ctrl',
			// theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
			// transition: Reveal.getQueryHash().transition || 'default'
			// Optional reveal.js plugins
			dependencies: [
				{ src: '../../../lib/reveal.js/lib/js/classList.js', condition: function() { return !document.body.classList; } },
				{ src: '../../../lib/reveal.js/plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
				{ src: '../../../lib/reveal.js/plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
				{ src: '../../../lib/reveal.js/plugin/highlight/highlight.js', async: true, callback: function() { hljs.configure({tabReplace: highlightjsTabSize}); hljs.initHighlightingOnLoad(); } },
				{ src: '../../../lib/reveal.js/plugin/zoom-js/zoom.js', async: true },
				{ src: '../../../lib/reveal.js/plugin/notes/notes.js', async: true }
			]
		});
	</script>
	<!-- linkedin badge -->

</body>
</html>
